{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-12">
            <h2 class="h4 mb-4">Start Fasting Program</h2>
            
            <div class="card">
                <div class="card-body">
                    <h3 class="h5 mb-3" id="programName"></h3>
                    <p class="text-muted mb-4" id="programDescription"></p>

                    <div class="mb-4">
                        <h4 class="h6">Benefits</h4>
                        <p id="programBenefits"></p>
                    </div>

                    <div class="mb-4">
                        <h4 class="h6">Instructions</h4>
                        <p id="programInstructions"></p>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Starting this program will cancel any active fasting sessions.
                    </div>

                    <button id="startFastBtn" class="btn btn-primary">Start Fast</button>
                    <a href="/dashboard" class="btn btn-link">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get program ID from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const programId = urlParams.get('program_id');

    if (!programId) {
        window.location.href = '/dashboard';
        return;
    }

    // Fetch program details
    fetch(`/api/fasting/programs/${programId}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                document.getElementById('programName').textContent = data.program.name;
                document.getElementById('programDescription').textContent = data.program.description;
                document.getElementById('programBenefits').textContent = data.program.benefits;
                document.getElementById('programInstructions').textContent = data.program.instructions;
            } else {
                window.location.href = '/dashboard';
            }
        })
        .catch(error => {
            console.error('Error fetching program details:', error);
            window.location.href = '/dashboard';
        });

    // Handle start button click
    document.getElementById('startFastBtn').addEventListener('click', function() {
        this.disabled = true;
        this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Starting...';

        fetch('/api/fasting/start', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ program_id: programId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                window.location.href = '/dashboard?tab=fasting';
            } else {
                alert(data.message || 'Failed to start fasting session');
                this.disabled = false;
                this.textContent = 'Start Fast';
            }
        })
        .catch(error => {
            console.error('Error starting fast:', error);
            alert('An error occurred while starting the fast');
            this.disabled = false;
            this.textContent = 'Start Fast';
        });
    });
});
</script>
{% endblock %}
