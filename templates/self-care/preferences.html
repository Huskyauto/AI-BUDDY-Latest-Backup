{% extends "base.html" %}

{% block title %}Self-Care Preferences | AI-BUDDY{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('self_care.self_care_index') }}">Self-Care</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Preferences</li>
                </ol>
            </nav>
            
            <h1 class="mb-4">Self-Care Preferences</h1>
            <p class="lead">Customize your self-care recommendations to better match your preferences and lifestyle.</p>
        </div>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Recommendation Preferences</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('self_care.preferences') }}">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6 class="mb-3">Activity Preferences</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">Activity Types</label>
                                    <div class="form-text mb-2">Select the types of activities you prefer:</div>
                                    
                                    {% set activity_types = [
                                        ('meditation', 'Meditation & Mindfulness'),
                                        ('movement', 'Physical Movement'),
                                        ('breathing', 'Breathing Exercises'),
                                        ('nature', 'Nature Connection'),
                                        ('social', 'Social Connection'),
                                        ('creative', 'Creative Activities'),
                                        ('learning', 'Learning & Growth'),
                                        ('rest', 'Rest & Recovery')
                                    ] %}
                                    
                                    {% for type_id, type_name in activity_types %}
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="true" 
                                                id="pref_activity_{{ type_id }}" name="pref_activity_{{ type_id }}"
                                                {% if preferences.get('activity_' + type_id) == 'true' %} checked {% endif %}>
                                            <label class="form-check-label" for="pref_activity_{{ type_id }}">
                                                {{ type_name }}
                                            </label>
                                        </div>
                                    {% endfor %}
                                </div>
                                
                                <div class="mb-3">
                                    <label for="pref_activity_duration" class="form-label">Preferred Activity Duration</label>
                                    <select class="form-select" id="pref_activity_duration" name="pref_activity_duration">
                                        <option value="short" {% if preferences.get('activity_duration') == 'short' %} selected {% endif %}>Short (5-10 minutes)</option>
                                        <option value="medium" {% if preferences.get('activity_duration') == 'medium' %} selected {% endif %}>Medium (10-20 minutes)</option>
                                        <option value="long" {% if preferences.get('activity_duration') == 'long' %} selected {% endif %}>Long (20+ minutes)</option>
                                    </select>
                                    <div class="form-text">How much time do you typically have for self-care activities?</div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h6 class="mb-3">Timing & Context</h6>
                                
                                <div class="mb-3">
                                    <label for="pref_time_of_day" class="form-label">Preferred Time of Day</label>
                                    <select class="form-select" id="pref_time_of_day" name="pref_time_of_day">
                                        <option value="morning" {% if preferences.get('time_of_day') == 'morning' %} selected {% endif %}>Morning</option>
                                        <option value="afternoon" {% if preferences.get('time_of_day') == 'afternoon' %} selected {% endif %}>Afternoon</option>
                                        <option value="evening" {% if preferences.get('time_of_day') == 'evening' %} selected {% endif %}>Evening</option>
                                        <option value="any" {% if preferences.get('time_of_day') == 'any' %} selected {% endif %}>Any time</option>
                                    </select>
                                    <div class="form-text">When do you prefer to do self-care activities?</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="pref_recommendations_per_day" class="form-label">Recommendations Per Day</label>
                                    <select class="form-select" id="pref_recommendations_per_day" name="pref_recommendations_per_day">
                                        <option value="1" {% if preferences.get('recommendations_per_day') == '1' %} selected {% endif %}>1 per day</option>
                                        <option value="2" {% if preferences.get('recommendations_per_day') == '2' %} selected {% endif %}>2 per day</option>
                                        <option value="3" {% if preferences.get('recommendations_per_day') == '3' %} selected {% endif %}>3 per day</option>
                                        <option value="5+" {% if preferences.get('recommendations_per_day') == '5+' %} selected {% endif %}>5+ per day</option>
                                    </select>
                                    <div class="form-text">How many recommendations would you like to receive each day?</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="pref_location_based" class="form-label">Location-Based Recommendations</label>
                                    <select class="form-select" id="pref_location_based" name="pref_location_based">
                                        <option value="enabled" {% if preferences.get('location_based') == 'enabled' %} selected {% endif %}>Enabled</option>
                                        <option value="disabled" {% if preferences.get('location_based') == 'disabled' %} selected {% endif %}>Disabled</option>
                                    </select>
                                    <div class="form-text">Would you like to receive location-aware recommendations?</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <h6 class="mb-3">Health Goals</h6>
                                
                                <div class="mb-3">
                                    <label class="form-label">Primary Self-Care Goals</label>
                                    <div class="form-text mb-2">Select up to 3 primary goals:</div>
                                    
                                    {% set goals = [
                                        ('stress_reduction', 'Reduce stress & anxiety'),
                                        ('mood_improvement', 'Improve mood & emotional well-being'),
                                        ('focus_productivity', 'Enhance focus & productivity'),
                                        ('energy_levels', 'Increase energy levels'),
                                        ('sleep_quality', 'Improve sleep quality'),
                                        ('physical_health', 'Support physical health'),
                                        ('social_connection', 'Strengthen social connections'),
                                        ('purpose_meaning', 'Cultivate purpose & meaning')
                                    ] %}
                                    
                                    <div class="row">
                                        {% for goal_id, goal_name in goals %}
                                            <div class="col-md-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="true" 
                                                        id="pref_goal_{{ goal_id }}" name="pref_goal_{{ goal_id }}"
                                                        {% if preferences.get('goal_' + goal_id) == 'true' %} checked {% endif %}>
                                                    <label class="form-check-label" for="pref_goal_{{ goal_id }}">
                                                        {{ goal_name }}
                                                    </label>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12">
                                <button type="submit" class="btn btn-primary">Save Preferences</button>
                                <a href="{{ url_for('self_care.self_care_index') }}" class="btn btn-outline-secondary ms-2">Cancel</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Limit the number of selected goals to 3
    const goalCheckboxes = document.querySelectorAll('[id^="pref_goal_"]');
    
    goalCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const selectedGoals = document.querySelectorAll('[id^="pref_goal_"]:checked');
            
            if (selectedGoals.length > 3) {
                this.checked = false;
                alert('Please select no more than 3 primary goals.');
            }
        });
    });
});
</script>
{% endblock %}